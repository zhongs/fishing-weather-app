# æœ¬åœ°å¼€å‘æŒ‡å—

## Netlify Functions æœ¬åœ°å¼€å‘

### ğŸ¯ å·¥ä½œåŸç†

é¡¹ç›®ä½¿ç”¨ **Netlify Functions** ä½œä¸ºåç«¯ä»£ç†ï¼Œå¤„ç†å’Œé£å¤©æ°” API çš„ JWT è®¤è¯ï¼š

```
å‰ç«¯ â†’ Netlify Function (ä»£ç†) â†’ å’Œé£å¤©æ°” API
```

### ğŸš€ å¯åŠ¨æ–¹å¼

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Netlify CLIï¼ˆæ¨èï¼‰

```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
npm install

# 2. å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆåŒæ—¶å¯åŠ¨ Vite + Functionsï¼‰
npm run dev:netlify
```

è¿™ä¼šåŒæ—¶å¯åŠ¨ï¼š
- å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆViteï¼‰ï¼š`http://localhost:5173`
- Netlify Functionsï¼š`http://localhost:8888/.netlify/functions/*`

#### æ–¹å¼äºŒï¼šä»…å¯åŠ¨å‰ç«¯ï¼ˆä¸æµ‹è¯• Functionsï¼‰

```bash
npm run dev
```

âš ï¸ **æ³¨æ„**ï¼šæ­¤æ–¹å¼ä¸‹ï¼Œå’Œé£å¤©æ°” API è°ƒç”¨ä¼šå¤±è´¥ï¼Œå› ä¸º Functions æ²¡æœ‰è¿è¡Œã€‚

### ğŸ“ æ–‡ä»¶ç»“æ„

```
fishing-weather-app/
â”œâ”€â”€ netlify/
â”‚   â””â”€â”€ functions/
â”‚       â””â”€â”€ qweather-proxy.mjs      # Netlify Functionï¼ˆä»£ç†ï¼‰
â”œâ”€â”€ src/
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ qweatherApi.js          # å‰ç«¯è°ƒç”¨ä»£ç†çš„æ¥å£
â””â”€â”€ netlify.toml                     # Netlify é…ç½®æ–‡ä»¶
```

### ğŸ”‘ ç¯å¢ƒå˜é‡é…ç½®

#### æœ¬åœ°å¼€å‘ï¼ˆ.env æ–‡ä»¶ï¼‰

```bash
# å’Œé£å¤©æ°”é…ç½®
QWEATHER_PROJECT_ID=ä½ çš„é¡¹ç›®ID
QWEATHER_CREDENTIAL_ID=ä½ çš„å‡­æ®ID
QWEATHER_API_HOST=https://devapi.qweather.com
# ç§é’¥ï¼ˆå¯é€‰ï¼Œä¼šè‡ªåŠ¨ä» ed25519-private.pem è¯»å–ï¼‰
QWEATHER_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----
...
-----END PRIVATE KEY-----"

# é«˜å¾·åœ°å›¾é…ç½®
VITE_AMAP_KEY=ä½ çš„é«˜å¾·åœ°å›¾Key
```

#### ç”Ÿäº§ç¯å¢ƒï¼ˆNetlify Dashboardï¼‰

åœ¨ Netlify æ§åˆ¶å°é…ç½®ï¼š
- Site configuration â†’ Environment variables
- æ·»åŠ æ‰€æœ‰ä»¥ä¸Šå˜é‡

### ğŸ” è°ƒè¯• Functions

#### æŸ¥çœ‹ Function æ—¥å¿—

```bash
# å¯åŠ¨ netlify dev åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤º Function çš„ console.log è¾“å‡º
npm run dev:netlify
```

#### æµ‹è¯• Function ç«¯ç‚¹

```bash
# ç›´æ¥è®¿é—® Function
curl "http://localhost:8888/.netlify/functions/qweather-proxy?endpoint=/v7/weather/now&location=116.40,39.90"
```

#### æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒæ—¥å¿—

1. ç™»å½• Netlify Dashboard
2. é€‰æ‹©é¡¹ç›® â†’ Functions
3. ç‚¹å‡» `qweather-proxy` æŸ¥çœ‹å®æ—¶æ—¥å¿—

### âš¡ å¿«é€Ÿå‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# æœ¬åœ°å¼€å‘ï¼ˆå¸¦ Functionsï¼‰
npm run dev:netlify

# ä»…å‰ç«¯å¼€å‘
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview
```

### ğŸ› å¸¸è§é—®é¢˜

#### Q1: `netlify: command not found`
```bash
# å®‰è£… Netlify CLI
npm install -g netlify-cli
# æˆ–ä½¿ç”¨é¡¹ç›®æœ¬åœ°çš„
npx netlify dev
```

#### Q2: Function æŠ¥é”™ "ç§é’¥æœªé…ç½®"
- æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¡®è®¤ `ed25519-private.pem` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
- æˆ–åœ¨ `.env` ä¸­é…ç½® `QWEATHER_PRIVATE_KEY`

#### Q3: å‰ç«¯è¯·æ±‚ Function å¤±è´¥
- ç¡®è®¤ `netlify dev` æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ `http://localhost:8888/.netlify/functions/qweather-proxy` æ˜¯å¦å¯è®¿é—®
- æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—è¾“å‡º

#### Q4: é«˜å¾·åœ°å›¾ API æŠ¥é”™ "INVALID_USER_KEY"
- ç¡®è®¤ `.env` ä¸­å·²é…ç½® `VITE_AMAP_KEY`
- é‡å¯å¼€å‘æœåŠ¡å™¨ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
- æ£€æŸ¥ Key æ˜¯å¦æ­£ç¡®

### ğŸ“¦ éƒ¨ç½²æµç¨‹

1. **æ¨é€åˆ° GitHub**
   ```bash
   git add .
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"
   git push origin main
   ```

2. **Netlify è‡ªåŠ¨éƒ¨ç½²**
   - è‡ªåŠ¨æ£€æµ‹åˆ°æ¨é€
   - è¿è¡Œ `npm run build`
   - éƒ¨ç½²å‰ç«¯å’Œ Functions
   - å‡ åˆ†é’Ÿåå®Œæˆ

3. **éªŒè¯éƒ¨ç½²**
   - è®¿é—®ä½ çš„ Netlify åŸŸå
   - æ£€æŸ¥ Functions æ—¥å¿—
   - æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### ğŸ”— ç›¸å…³èµ„æº

- [Netlify Functions æ–‡æ¡£](https://docs.netlify.com/functions/overview/)
- [Netlify CLI æ–‡æ¡£](https://docs.netlify.com/cli/get-started/)
- [å’Œé£å¤©æ°” API æ–‡æ¡£](https://dev.qweather.com/docs/)
- [é«˜å¾·åœ°å›¾ WebæœåŠ¡ API](https://lbs.amap.com/api/webservice/summary)
